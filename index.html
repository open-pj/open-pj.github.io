<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Neon Portfolio ‚Äî Open Source Projects (Firebase + Firestore)</title>
<meta name="description" content="Neon portfolio ‚Äî –¥–æ–¥–∞–≤–∞–Ω–Ω—è/—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—ñ–≤ + Google Sign-In + Firestore" />
<style>
  /* ---------- –ù–ï–û–ù–û–í–ò–ô –°–¢–ò–õ–¨ ---------- */
  :root{
    --bg:#050512; --panel:rgba(255,255,255,0.03); --muted:#9fb0c8;
    --accent-a:#7dd3fc; --accent-b:#a78bfa; --neon:#00f0ff;
    --radius:12px; --gap:16px; --maxw:1200px;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;background:
    radial-gradient(700px 360px at 10% 8%, rgba(125,211,252,0.04), transparent),
    linear-gradient(180deg,var(--bg), #020214 120%);color:#eaf6ff;font-family:Inter,system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;padding:20px;display:flex;justify-content:center;}
  .wrap{width:100%;max-width:var(--maxw)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));display:grid;place-items:center;font-weight:800;color:#021827;font-size:18px;box-shadow:0 10px 40px rgba(125,211,252,0.06) inset}
  h1{margin:0;font-size:20px}
  .lead{margin:0;color:var(--muted);font-size:13px}

  .controls{display:flex;gap:10px;align-items:center}
  .input,.select,.btn{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border:1px solid rgba(255,255,255,0.03);padding:10px 12px;border-radius:10px;color:inherit;outline:none}
  .btn{cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));border:none;color:#021827;font-weight:700;padding:10px 14px}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

  .topbar{display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap}
  .avatar{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#05232e,#071029);display:grid;place-items:center;font-weight:800;color:var(--accent-a);font-size:18px}
  .profile-info .name{font-weight:700}
  .profile-info .bio{color:var(--muted);font-size:13px}

  .lang-switch{display:flex;gap:6px}
  .lang-switch button{padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted);cursor:pointer}
  .lang-switch button.active{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:#021827;font-weight:700}

  /* Grid */
  main{display:block}
  .grid{display:grid;gap:var(--gap);grid-auto-rows:1fr}
  @media (min-width:1200px){ .grid{grid-template-columns:repeat(4,1fr);} }
  @media (min-width:900px) and (max-width:1199px){ .grid{grid-template-columns:repeat(3,1fr);} }
  @media (min-width:640px) and (max-width:899px){ .grid{grid-template-columns:repeat(2,1fr);} }
  @media (max-width:639px){ .grid{grid-template-columns:1fr} header{flex-direction:column;align-items:flex-start} }

  .card{position:relative;padding:14px;border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,0.018), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);min-height:140px;display:flex;flex-direction:column;gap:8px;box-shadow:0 8px 30px rgba(2,6,23,0.6);transition:transform .22s,box-shadow .22s}
  .card:hover{transform:translateY(-8px) scale(1.01);box-shadow:0 24px 60px rgba(2,6,23,0.8)}
  .title{font-weight:800;margin:0;font-size:15px}
  .desc{color:var(--muted);font-size:13px}
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{padding:6px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));color:var(--neon)}
  .meta{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px}
  .actions{display:flex;gap:8px;align-items:center;margin-top:auto}

  /* modal */
  .modal-back{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:50}
  .modal{width:100%;max-width:640px;background:linear-gradient(180deg,#071029,#031122);border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
  .form-row{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
  input[type="text"],textarea{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;outline:none}
  textarea{min-height:90px;resize:vertical}
  .muted{color:var(--muted)}
  .center{text-align:center}

  footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center}
  /* entrance */
  .card{opacity:0;transform:translateY(18px) scale(.995)}
  .card.visible{opacity:1;transform:none;transition:opacity .6s ease, transform .6s cubic-bezier(.2,.9,.3,1)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" id="logo-nick">NET</div>
        <div>
          <h1 id="main-title">Neon Open Source Portfolio</h1>
          <p class="lead" id="main-sub">–ü—ñ–¥–∫–ª—é—á–∏—Å—å —á–µ—Ä–µ–∑ Google —â–æ–± –∫–µ—Ä—É–≤–∞—Ç–∏ —Å–≤–æ—ó–º–∏ –ø—Ä–æ—î–∫—Ç–∞–º–∏</p>
        </div>
      </div>

      <div class="controls">
        <input id="search" class="input" placeholder="–ü–æ—à—É–∫: –Ω–∞–∑–≤–∞, –æ–ø–∏—Å, —Ç–µ–≥–∏..." />
        <select id="filter" class="select" title="–§—ñ–ª—å—Ç—Ä">
          <option value="all">–í—Å—ñ</option>
          <option value="js">JavaScript</option>
          <option value="py">Python</option>
          <option value="web">Web</option>
          <option value="lib">–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏</option>
          <option value="tool">–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏</option>
        </select>
        <button id="auth-btn" class="btn primary">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
      </div>
    </header>

    <div class="topbar">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="avatar" id="avatar-preview">U</div>
        <div class="profile-info">
          <div class="name" id="profile-name">–ì—ñ—Å—Ç—å</div>
          <div class="bio" id="profile-bio">–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</div>
        </div>
      </div>

      <div style="margin-left:auto;display:flex;gap:12px;align-items:center">
        <button id="add-project" class="btn ghost" title="–î–æ–¥–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç (–ø—ñ—Å–ª—è –≤—Ö–æ–¥—É)">–î–æ–¥–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç</button>
        <div class="lang-switch" role="tablist" aria-label="–ú–æ–≤–∏">
          <button data-lang="uk" class="active">üá∫üá¶ –£–ö–†</button>
          <button data-lang="ru">üá∑üá∫ –†–£–°</button>
          <button data-lang="en">üá¨üáß ENG</button>
        </div>
        <button id="edit-profile" class="btn">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</button>
      </div>
    </div>

    <main>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
        <h2 style="margin:0" id="section-title">–ü—Ä–æ—î–∫—Ç–∏</h2>
        <div class="muted">–ü–æ–∫–∞–∑–∞–Ω–æ <span id="count">0</span></div>
      </div>

      <div id="grid" class="grid" aria-live="polite"></div>
      <div id="empty" class="center muted" style="display:none;margin-top:18px">–ü—Ä–æ—î–∫—Ç—ñ–≤ —â–µ –Ω–µ–º–∞—î</div>
    </main>

    <footer>
      <div class="muted">¬© <span id="footer-name">–¢–≤–æ—î —ñ–º'—è</span> ‚Äî Neon Portfolio</div>
    </footer>
  </div>

  <!-- Modal area -->
  <div id="modal-back" class="modal-back" aria-hidden="true">
    <div class="modal" id="modal"></div>
  </div>

  <!-- Firebase SDK (modular) -->
  <script type="module">
  /*********************************************************************
   *  Firebase config ‚Äî —Ç–∏ –Ω–∞–¥–∞–≤ –∫–æ–Ω—Ñ—ñ–≥ —Ä–∞–Ω—ñ—à–µ; –∑–∞–º—ñ–Ω–∏ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ
   *********************************************************************/
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, setDoc, doc, onSnapshot, getDocs, updateDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBBislTzvtLqSLYXotrjwNaldoFG6dB7Uk",
    authDomain: "open-pj-bfcae.firebaseapp.com",
    projectId: "open-pj-bfcae",
    storageBucket: "open-pj-bfcae.firebasestorage.app",
    messagingSenderId: "900989349855",
    appId: "1:900989349855:web:317ec7b0b05fcba1cf9e6a",
    measurementId: "G-61SV2C58J9"
  };

  // ---------- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase ----------
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const db = getFirestore(app);

  // ---------- DOM refs ----------
  const authBtn = document.getElementById('auth-btn');
  const addBtn = document.getElementById('add-project');
  const editProfileBtn = document.getElementById('edit-profile');
  const modalBack = document.getElementById('modal-back');
  const modal = document.getElementById('modal');
  const grid = document.getElementById('grid');
  const emptyEl = document.getElementById('empty');
  const countEl = document.getElementById('count');
  const avatarPreview = document.getElementById('avatar-preview');
  const profileNameEl = document.getElementById('profile-name');
  const profileBioEl = document.getElementById('profile-bio');
  const logoNick = document.getElementById('logo-nick');
  const footerName = document.getElementById('footer-name');
  const langButtons = document.querySelectorAll('.lang-switch button');
  const searchEl = document.getElementById('search');
  const filterEl = document.getElementById('filter');

  // ---------- App state ----------
  let user = null;        // Firebase user object when signed in
  let unsub = null;       // Firestore onSnapshot unsubscribe function
  let projects = [];      // local copy of projects currently shown
  let currentLang = localStorage.getItem('np_lang') || 'uk';
  const PROFILE_KEY = 'np_profile_v1';

  // ---------- i18n ----------
  const I18 = {
    uk: { add:'–î–æ–¥–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç', edit:'–†–µ–¥–∞–≥—É–≤–∞—Ç–∏', del:'–í–∏–¥–∞–ª–∏—Ç–∏', saved:'–ó–±–µ—Ä–µ–∂–µ–Ω–æ', login:'–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google', logout:'–í–∏–π—Ç–∏', projects:'–ü—Ä–æ—î–∫—Ç–∏', empty:'–ü—Ä–æ—î–∫—Ç—ñ–≤ —â–µ –Ω–µ–º–∞—î', confirmDel:'–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–æ—î–∫—Ç?' },
    ru: { add:'–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç', edit:'–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å', del:'–£–¥–∞–ª–∏—Ç—å', saved:'–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ', login:'–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google', logout:'–í—ã–π—Ç–∏', projects:'–ü—Ä–æ–µ–∫—Ç—ã', empty:'–ü—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç', confirmDel:'–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?' },
    en: { add:'Add project', edit:'Edit', del:'Delete', saved:'Saved', login:'Sign in with Google', logout:'Sign out', projects:'Projects', empty:'No projects yet', confirmDel:'Are you sure you want to delete this project?' }
  };

  // ---------- Helpers ----------
  function t(k){ return I18[currentLang][k] || k; }
  function saveProfileLocal(p){ localStorage.setItem(PROFILE_KEY, JSON.stringify(p)); }
  function loadProfileLocal(){ try{ return JSON.parse(localStorage.getItem(PROFILE_KEY))||{} }catch(e){return{}} }
  function escapeHtml(s){ return String(s||'').replace(/[&<>"]/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[ch])); }
  function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); } }

  // ---------- Update UI / i18n ----------
  function updateI18n(){
    document.getElementById('main-title').textContent = 'Neon Open Source Portfolio';
    document.getElementById('main-sub').textContent = '–ü—ñ–¥–∫–ª—é—á–∏—Å—å —á–µ—Ä–µ–∑ Google —â–æ–± –∫–µ—Ä—É–≤–∞—Ç–∏ —Å–≤–æ—ó–º–∏ –ø—Ä–æ—î–∫—Ç–∞–º–∏';
    document.getElementById('section-title').textContent = t('projects');
    authBtn.textContent = user ? t('logout') : t('login');
    addBtn.textContent = t('add');
    // lang buttons
    langButtons.forEach(b=>b.classList.toggle('active', b.dataset.lang === currentLang));
    localStorage.setItem('np_lang', currentLang);
  }

  // ---------- Auth handlers ----------
  authBtn.addEventListener('click', async ()=>{
    if(!user){
      try{
        await signInWithPopup(auth, provider);
        // onAuthStateChanged will handle UI
      }catch(err){
        console.error('Sign-in error', err);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è —É–≤—ñ–π—Ç–∏: ' + (err.message||err));
      }
    } else {
      await signOut(auth);
    }
  });

  onAuthStateChanged(auth, async (u)=>{
    user = u;
    if(user){
      // load profile from localStorage and merge
      const p = loadProfileLocal();
      p.name = p.name || user.displayName || (user.email || '').split('@')[0];
      p.avatarInitials = p.avatarInitials || getInitials(p.name);
      saveProfileLocal(p);
      renderProfile();
      subscribeToProjects();
    } else {
      // signed out
      renderProfile();
      unsubscribeProjects();
      // optionally load local-only projects or show empty
      projects = []; renderProjects();
    }
    updateI18n();
  });

  // ---------- Firestore subscribe / CRUD ----------
  function userProjectsCollectionRef(){
    if(!user) return null;
    return collection(db, 'users', user.uid, 'projects');
  }

  function subscribeToProjects(){
    unsubscribeProjects();
    const ref = userProjectsCollectionRef();
    if(!ref) return;
    // listen ordered by createdAt (if exists), fallback to name
    const q = query(ref, orderBy('createdAt','desc'));
    unsub = onSnapshot(q, snap=>{
      const arr = [];
      snap.forEach(d=> arr.push({ id: d.id, ...d.data() }));
      projects = arr;
      renderProjects();
    }, err=>{
      console.error('snapshot error', err);
      // fallback: load via getDocs once
      loadProjectsOnce();
    });
  }

  function unsubscribeProjects(){
    if(typeof unsub === 'function') unsub(), unsub = null;
  }

  async function loadProjectsOnce(){
    const ref = userProjectsCollectionRef();
    if(!ref){ projects = []; renderProjects(); return; }
    try{
      const snap = await getDocs(query(ref, orderBy('createdAt','desc')));
      const arr=[];
      snap.forEach(d=> arr.push({ id:d.id, ...d.data() }));
      projects = arr;
      renderProjects();
    }catch(err){ console.error(err); projects = []; renderProjects(); }
  }

  async function addProject(data){
    const ref = userProjectsCollectionRef();
    if(!ref){ // fallback to localStorage if user not logged
      // save locally per-session (not persisted across devices)
      const local = JSON.parse(localStorage.getItem('np_local_projects')||'[]');
      local.unshift({ id:'local_'+Date.now(), ...data });
      localStorage.setItem('np_local_projects', JSON.stringify(local));
      projects = local;
      renderProjects();
      return;
    }
    try{
      const docRef = await addDoc(ref, { ...data, createdAt: new Date() });
      console.log('added doc', docRef.id);
    }catch(err){ console.error('addProject error', err); alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –¥–æ–¥–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç: ' + (err.message||err)); }
  }

  async function updateProject(id, data){
    const ref = userProjectsCollectionRef();
    if(!ref){
      const local = JSON.parse(localStorage.getItem('np_local_projects')||'[]');
      const idx = local.findIndex(x=>x.id===id);
      if(idx>=0){ local[idx] = { ...local[idx], ...data }; localStorage.setItem('np_local_projects', JSON.stringify(local)); projects = local; renderProjects(); }
      return;
    }
    try{
      await updateDoc(doc(db, 'users', user.uid, 'projects', id), { ...data, updatedAt: new Date() });
    }catch(err){ console.error('updateProject error', err); alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏: '+(err.message||err)); }
  }

  async function deleteProject(id){
    const ref = userProjectsCollectionRef();
    if(!ref){
      const local = JSON.parse(localStorage.getItem('np_local_projects')||'[]').filter(x=>x.id!==id);
      localStorage.setItem('np_local_projects', JSON.stringify(local));
      projects = local; renderProjects(); return;
    }
    if(!confirm(t('confirmDel'))) return;
    try{
      await deleteDoc(doc(db, 'users', user.uid, 'projects', id));
    }catch(err){ console.error('deleteProject error', err); alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏: '+(err.message||err)); }
  }

  // ---------- Render projects ----------
  function renderProjects(){
    const list = projects || [];
    grid.innerHTML = '';
    if(!list.length){ emptyEl.style.display='block'; countEl.textContent = 0; return; }
    emptyEl.style.display='none';
    countEl.textContent = list.length;
    list.forEach((p,i)=>{
      const card = document.createElement('article'); card.className='card';
      card.innerHTML = `
        <div>
          <h3 class="title">${escapeHtml(p.title)}</h3>
          <div class="desc">${escapeHtml(p.desc||'')}</div>
          <div class="tags">${(p.tags||[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('')}</div>
        </div>
        <div class="actions">
          <a class="btn ghost" href="${escapeAttr(p.link||'#')}" target="_blank" rel="noopener">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
          <div class="meta">${p.stars? (p.stars + ' ‚òÖ') : ''}</div>
        </div>
      `;
      // admin controls if current user
      if(user){
        const ctrl = document.createElement('div'); ctrl.style.display='flex'; ctrl.style.gap='8px'; ctrl.style.marginTop='8px';
        const edit = document.createElement('button'); edit.className='btn ghost'; edit.textContent = t('edit'); edit.addEventListener('click', ()=>openProjectModal(p));
        const del = document.createElement('button'); del.className='btn'; del.textContent = t('del'); del.addEventListener('click', ()=>deleteProject(p.id));
        ctrl.appendChild(edit); ctrl.appendChild(del);
        card.querySelector('.actions').appendChild(ctrl);
      }
      grid.appendChild(card);
      // entrance
      requestAnimationFrame(()=>setTimeout(()=>card.classList.add('visible'), i*50));
      // tilt
      card.addEventListener('pointermove', (e)=>{
        const rect = card.getBoundingClientRect();
        const dx = e.clientX - (rect.left + rect.width/2);
        const dy = e.clientY - (rect.top + rect.height/2);
        card.style.transform = `perspective(800px) rotateX(${(-dy/20)}deg) rotateY(${(dx/20)}deg) translateZ(0)`;
      });
      card.addEventListener('pointerleave', ()=>card.style.transform = '');
    });
  }

  // ---------- Modal helpers ----------
  function openModal(html){
    modal.innerHTML = html;
    modalBack.style.display = 'flex';
    modalBack.setAttribute('aria-hidden','false');
  }
  function closeModal(){ modalBack.style.display = 'none'; modal.innerHTML=''; modalBack.setAttribute('aria-hidden','true'); }
  modalBack.addEventListener('click', (e)=>{ if(e.target===modalBack) closeModal(); });

  // ---------- Add / Edit project modal ----------
  addBtn.addEventListener('click', ()=>{
    if(!user){ if(!confirm('–ü–æ—Ç—Ä—ñ–±–Ω–æ —É–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google, —â–æ–± –¥–æ–¥–∞–≤–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç–∏. –£–≤—ñ–π—Ç–∏?')) return authBtn.click(); }
    openProjectModal();
  });

  function openProjectModal(existing){
    const isEdit = !!existing;
    const titleVal = isEdit ? existing.title : '';
    const descVal = isEdit ? existing.desc : '';
    const linkVal = isEdit ? existing.link : '';
    const tagsVal = isEdit ? (existing.tags||[]).join(', ') : '';
    openModal(`
      <h3>${isEdit ? t('edit') : t('add')}</h3>
      <div class="form-row"><label>–ù–∞–∑–≤–∞</label><input id="proj-title" type="text" value="${escapeAttr(titleVal)}" /></div>
      <div class="form-row"><label>–û–ø–∏—Å</label><textarea id="proj-desc">${escapeHtml(descVal)}</textarea></div>
      <div class="form-row"><label>–ü–æ—Å–∏–ª–∞–Ω–Ω—è</label><input id="proj-link" type="text" value="${escapeAttr(linkVal)}" /></div>
      <div class="form-row"><label>–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∫–æ–º—É)</label><input id="proj-tags" type="text" value="${escapeAttr(tagsVal)}" /></div>
      <div style="display:flex;justify-content:flex-end;gap:8px">
        <button id="save-proj" class="btn primary">${t('saved')}</button>
        <button id="cancel-proj" class="btn">${t('edit')}</button>
      </div>
    `);
    document.getElementById('cancel-proj').addEventListener('click', closeModal);
    document.getElementById('save-proj').addEventListener('click', async ()=>{
      const title = document.getElementById('proj-title').value.trim();
      const desc = document.getElementById('proj-desc').value.trim();
      const link = document.getElementById('proj-link').value.trim();
      const tags = (document.getElementById('proj-tags').value||'').split(',').map(s=>s.trim()).filter(Boolean);
      if(!title) { alert('–í–∫–∞–∂–∏ –Ω–∞–∑–≤—É'); return; }
      const payload = { title, desc, link, tags, updatedAt: new Date() };
      if(isEdit){
        await updateProject(existing.id, payload);
      } else {
        await addProject({ ...payload, createdAt: new Date() });
      }
      closeModal();
    });
  }

  // ---------- Profile editor ----------
  editProfileBtn.addEventListener('click', ()=>{
    const p = loadProfileLocal();
    openModal(`
      <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</h3>
      <div class="form-row"><label>–ù—ñ–∫ (–≤ –ª–æ–≥–æ—Ç–∏–ø—ñ)</label><input id="p-nick" type="text" value="${escapeAttr(p.nick||'NET')}" /></div>
      <div class="form-row"><label>–Ü–º'—è</label><input id="p-name" type="text" value="${escapeAttr(p.name||'–¢–≤–æ—î —ñ–º º—è')}" /></div>
      <div class="form-row"><label>–ü—Ä–æ –º–µ–Ω–µ</label><textarea id="p-bio">${escapeHtml(p.bio||'')}</textarea></div>
      <div class="form-row"><label>–Ü–Ω—ñ—Ü—ñ–∞–ª–∏ –∞–≤–∞—Ç–∞—Ä–∞</label><input id="p-avatar" type="text" maxlength="2" value="${escapeAttr(p.avatarInitials||getInitials(p.name||p.nick||'U'))}" /></div>
      <div style="display:flex;justify-content:flex-end;gap:8px">
        <button id="save-profile" class="btn primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        <button id="close-profile" class="btn">–ó–∞–∫—Ä–∏—Ç–∏</button>
      </div>
    `);
    document.getElementById('close-profile').addEventListener('click', closeModal);
    document.getElementById('save-profile').addEventListener('click', ()=>{
      const nick = (document.getElementById('p-nick').value||'').trim() || 'NET';
      const name = (document.getElementById('p-name').value||'').trim() || '–¢–≤–æ—î —ñ–º º—è';
      const bio = (document.getElementById('p-bio').value||'').trim();
      const avatarInitials = (document.getElementById('p-avatar').value||'').trim().toUpperCase().slice(0,2) || getInitials(name);
      const profile = { nick, name, bio, avatarInitials };
      saveProfileLocal(profile);
      renderProfile();
      closeModal();
    });
  });

  function renderProfile(){
    const p = loadProfileLocal();
    avatarPreview.textContent = p.avatarInitials || getInitials(p.name||p.nick||'U');
    profileNameEl.textContent = p.name || (user? user.displayName : '–ì—ñ—Å—Ç—å');
    profileBioEl.textContent = p.bio || (user ? '–†–µ–¥–∞–≥—É–π—Ç–µ —Å–≤—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å' : '–£–≤—ñ–π–¥—ñ—Ç—å —â–æ–± —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å');
    logoNick.textContent = (p.nick||'NET').slice(0,6).toUpperCase();
    footerName.textContent = p.name || '–¢–≤–æ—î —ñ–º º—è';
  }

  // ---------- Utility ----------
  function getInitials(name){ if(!name) return 'U'; return name.split(' ').map(s=>s[0]||'').join('').slice(0,2).toUpperCase(); }
  function escapeAttr(s){ return String(s||'').replace(/"/g,'&quot;'); }

  // ---------- Language switch ----------
  langButtons.forEach(b=> b.addEventListener('click', ()=>{
    langButtons.forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    currentLang = b.dataset.lang;
    updateI18n();
    renderProjects(); // re-render to reflect t() strings
  }));

  // ---------- Search & filter ----------
  searchEl.addEventListener('input', debounce(()=>{ renderProjects(); }, 160));
  filterEl.addEventListener('change', ()=>renderProjects());

  function filterAndSearch(list){
    const q = (searchEl.value||'').trim().toLowerCase();
    const f = filterEl.value;
    return (list||[]).filter(p=>{
      if(q){
        if((p.title||'').toLowerCase().includes(q)) return true;
        if((p.desc||'').toLowerCase().includes(q)) return true;
        if((p.tags||[]).some(t=>t.toLowerCase().includes(q))) return true;
        return false;
      }
      if(f && f!=='all'){
        return (p.tags||[]).includes(f) || (p.language||'').toLowerCase()===f;
      }
      return true;
    });
  }

  // ---------- On load: try to load local cached projects if signed-out ----------
  (function init(){
    updateI18n();
    renderProfile();
    // if user already signed in, onAuthStateChanged will subscribe
    // else, try local projects
    const local = JSON.parse(localStorage.getItem('np_local_projects') || '[]');
    if(!user && local.length){ projects = local; renderProjects(); }
  })();

  // ---------- End of module ----------
  </script>

  <!-- Notes: Firestore security rules (example)
       Paste into Firebase Console -> Firestore -> Rules
  rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      // Allow users to read/write only their own projects
      match /users/{userId}/projects/{projectId} {
        allow read: if request.auth != null && request.auth.uid == userId;
        allow create: if request.auth != null && request.auth.uid == userId;
        allow update: if request.auth != null && request.auth.uid == userId;
        allow delete: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
  -->

</body>
</html>
